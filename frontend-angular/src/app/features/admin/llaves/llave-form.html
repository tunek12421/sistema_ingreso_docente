@if (show()) {
  <div class="fixed inset-0 z-50 overflow-y-auto" (click)="handleBackdropClick($event)">
    <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
      <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"></div>

      <span class="hidden sm:inline-block sm:align-middle sm:h-screen">&#8203;</span>

      <div class="relative inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
        <form [formGroup]="llaveForm" (ngSubmit)="onSubmit()">
          <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
            <div class="mb-6">
              <h3 class="text-lg leading-6 font-medium text-gray-900">
                {{ title }}
              </h3>
              <p class="mt-1 text-sm text-gray-500">
                {{ isEditMode ? 'Modifica los datos de la llave' : 'Completa los datos para crear una nueva llave' }}
              </p>
            </div>

            <!-- Form Fields -->
            <div class="space-y-4">
              <!-- Tipo y Número en la misma fila -->
              <div class="grid grid-cols-2 gap-4">
                <!-- Tipo de Aula -->
                <div>
                  <label for="tipo_aula" class="block text-sm font-medium text-gray-700">
                    Tipo <span class="text-red-500">*</span>
                  </label>
                  <select
                    id="tipo_aula"
                    formControlName="tipo_aula"
                    [class]="'mt-1 block w-full px-3 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 ' + (hasError('tipo_aula') ? 'border-red-300 focus:border-red-500' : 'border-gray-300 focus:border-primary-500')"
                  >
                    <option value="">Selecciona</option>
                    @for (tipo of tiposAula; track tipo.value) {
                      <option [value]="tipo.value">{{ tipo.label }}</option>
                    }
                  </select>
                  @if (hasError('tipo_aula')) {
                    <p class="mt-1 text-sm text-red-600">{{ getErrorMessage('tipo_aula') }}</p>
                  }
                </div>

                <!-- Número de Aula -->
                <div>
                  <label for="numero_aula" class="block text-sm font-medium text-gray-700">
                    Número <span class="text-red-500">*</span>
                  </label>
                  <input
                    type="number"
                    id="numero_aula"
                    formControlName="numero_aula"
                    [class]="'mt-1 block w-full px-3 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 ' + (hasError('numero_aula') ? 'border-red-300 focus:border-red-500' : 'border-gray-300 focus:border-primary-500')"
                    placeholder="Ej: 16"
                  />
                  @if (hasError('numero_aula')) {
                    <p class="mt-1 text-sm text-red-600">{{ getErrorMessage('numero_aula') }}</p>
                  }
                </div>
              </div>

              <!-- Preview de lo que se generará -->
              @if (llaveForm.get('tipo_aula')?.value && llaveForm.get('numero_aula')?.value) {
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                  <div class="flex items-center gap-2">
                    <svg class="h-5 w-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" />
                    </svg>
                    <div class="text-sm">
                      <span class="text-gray-600">Código: </span>
                      <span class="font-semibold text-blue-900">{{ llaveForm.get('codigo')?.value }}</span>
                    </div>
                  </div>
                </div>
              }

              <!-- Nombre Aula (opcional ahora) -->
              <div>
                <label for="aula_nombre" class="block text-sm font-medium text-gray-700">
                  Nombre Descriptivo (Opcional)
                </label>
                <input
                  type="text"
                  id="aula_nombre"
                  formControlName="aula_nombre"
                  [class]="'mt-1 block w-full px-3 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 ' + (hasError('aula_nombre') ? 'border-red-300 focus:border-red-500' : 'border-gray-300 focus:border-primary-500')"
                  placeholder="Ej: Aula Principal, Lab de Física"
                />
                <p class="mt-1 text-xs text-gray-500">Deja vacío para usar el nombre por defecto</p>
                @if (hasError('aula_nombre')) {
                  <p class="mt-1 text-sm text-red-600">{{ getErrorMessage('aula_nombre') }}</p>
                }
              </div>

              <!-- Estado -->
              <div>
                <label for="estado" class="block text-sm font-medium text-gray-700">
                  Estado <span class="text-red-500">*</span>
                </label>
                <select
                  id="estado"
                  formControlName="estado"
                  [class]="'mt-1 block w-full px-3 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 ' + (hasError('estado') ? 'border-red-300 focus:border-red-500' : 'border-gray-300 focus:border-primary-500')"
                >
                  @for (estado of estadosLlave; track estado.value) {
                    <option [value]="estado.value">{{ estado.label }}</option>
                  }
                </select>
                @if (hasError('estado')) {
                  <p class="mt-1 text-sm text-red-600">{{ getErrorMessage('estado') }}</p>
                }
              </div>

              <!-- Descripción -->
              <div>
                <label for="descripcion" class="block text-sm font-medium text-gray-700">
                  Descripción (Opcional)
                </label>
                <textarea
                  id="descripcion"
                  formControlName="descripcion"
                  rows="3"
                  class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                  placeholder="Detalles adicionales sobre la llave..."
                ></textarea>
              </div>
            </div>
          </div>

          <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
            <button
              type="submit"
              class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary-600 text-base font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:ml-3 sm:w-auto sm:text-sm"
            >
              {{ isEditMode ? 'Actualizar' : 'Crear' }}
            </button>
            <button
              type="button"
              (click)="cancel()"
              class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"
            >
              Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
}
